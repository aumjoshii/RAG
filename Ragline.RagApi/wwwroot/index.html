<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>Ragline RAG</title>
  <style>
    body { font-family: sans-serif; max-width: 900px; margin: 40px auto; }
    textarea { width: 100%; height: 90px; }
    pre { background: #f6f6f6; padding: 12px; overflow:auto; }
  </style>
</head>
<body>
  <h2>Ragline RAG</h2>

    <h3>Indexed Documents</h3>
  <button onclick="loadDocs()">Refresh</button>
  <pre id="docs"></pre>


  <h3>Upload (.pdf or .txt)</h3>
  <input id="file" type="file"/>
  <button onclick="upload()">Upload</button>
  <div id="uploadStatus"></div>

  <h3>Ask</h3>
  <textarea id="q" placeholder="Ask a question..."></textarea>
  <button onclick="ask()">Ask</button>

  <h3>Answer</h3>
  <div id="conf"></div>
  <pre id="ans"></pre>
  

  <h3>Sources</h3>
  <pre id="src"></pre>

<script>
async function upload() {
  const f = document.getElementById('file').files[0];
  if (!f) return;
  const fd = new FormData();
  fd.append('file', f);
  document.getElementById('uploadStatus').innerText = 'Uploading...';
  const r = await fetch('/documents', { method:'POST', body: fd });
  document.getElementById('uploadStatus').innerText = await r.text();
  await loadDocs();

}
async function ask() {
  const q = document.getElementById('q').value;
  const r = await fetch('/ask', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({ question:q, topK:5 })
  });
  const j = await r.json();
  const score = (j.bestScore ?? 0);
  const weak = (j.weakMatch === true);
  document.getElementById('conf').innerText =
    `confidence: ${score.toFixed(3)} ${weak ? "(weak match)" : ""}`;

  document.getElementById('ans').innerText = j.answer || '';
  document.getElementById('src').innerText = (j.sources||[]).map(s =>
    `score=${(s.score ?? 0).toFixed(3)} file=${s.fileName} page=${s.page ?? 'n/a'} chunk=${s.chunkIndex}\n${s.text}\n`
  ).join('\n---\n');
}
async function loadDocs() {
  const r = await fetch('/documents');
  const j = await r.json();
  document.getElementById('docs').innerText = (j || []).map(d =>
    `id=${d.id}\nfile=${d.fileName}\ncreatedUtc=${d.createdUtc}\n`
  ).join('\n---\n');
}

</script>
</body>
</html>
